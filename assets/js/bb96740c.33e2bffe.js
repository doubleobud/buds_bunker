"use strict";(self.webpackChunkbunker=self.webpackChunkbunker||[]).push([[7356],{3699:(e,t,r)=>{r.d(t,{R:()=>a});var s=r(5286);async function a(e,t){void 0===t&&(t={});const{data:{session:r}}=await s.N.auth.getSession(),a=r?.user?.id??null,{error:n}=await s.N.from("site_events").insert({user_id:a,event_type:e,payload:t});n&&console.error("Log error:",n)}},4448:(e,t,r)=>{r.d(t,{Rf:()=>o,r1:()=>i});var s=r(5286),a=r(3699);async function n(e,t,r){void 0===t&&(t="token"),void 0===r&&(r="");const{data:{session:n},error:o}=await s.N.auth.getSession();if(o||!n?.user)throw new Error("Not authenticated");const{error:i}=await s.N.rpc("rpc_modify_tokens",{_user:n.user.id,_amount:e,_token_type:t,_reason:r});if(i)throw i;await(0,a.R)("token_transaction",{type:t,amount:e,reason:r})}async function o(e,t,r){return void 0===t&&(t="token"),void 0===r&&(r="spent"),n(-Math.abs(e),t,r)}async function i(e){void 0===e&&(e="token");const{data:{session:t},error:r}=await s.N.auth.getSession();if(r||!t?.user)throw new Error("Not authenticated");const{data:a,error:n,status:o}=await s.N.from("characters").select("tokens_json").eq("user_id",t.user.id).maybeSingle();if(n&&406!==o)throw n;return parseInt((a?.tokens_json??{})[e]??0,10)}},4610:(e,t,r)=>{r.d(t,{CE:()=>n,gi:()=>o,t9:()=>i});var s=r(5286);const a=0;async function n(){const{data:{session:e}}=await s.N.auth.getSession(),t=e?.user;if(!t)throw new Error("Not authenticated");const{data:r,error:n}=await s.N.from("characters").select().eq("user_id",t.id).maybeSingle();if(n)throw console.error("[character] Fetch error:",n.message),n;if(r)return r;const o=String(Math.floor(1e5+9e5*Math.random())),{data:i,error:c}=await s.N.from("characters").insert({user_id:t.id,user_id_number:o,self:a,tokens_json:{token:0}}).select().single();if(c)throw console.error("[character] Insert error:",c.message),c;return i}async function o(){const{data:{session:e}}=await s.N.auth.getSession(),t=e?.user;if(!t)throw new Error("Not authenticated");const{data:r,error:a}=await s.N.from("characters").select().eq("user_id",t.id).maybeSingle();if(a)throw console.error("[character] Get error:",a.message),a;return r}async function i(e){const{data:{session:t}}=await s.N.auth.getSession(),r=t?.user;if(!r)throw new Error("Not authenticated");const{data:a,error:n}=await s.N.from("characters").update(e).eq("user_id",r.id).select().single();if(n)throw n;return a}},5541:(e,t,r)=>{r.d(t,{T:()=>o,s:()=>n});var s=r(5286),a=r(3699);async function n(e){const{data:{session:t},error:r}=await s.N.auth.getSession();if(r||!t?.user)throw new Error("Not authenticated");const{data:a,error:n}=await s.N.from("unlocks").select("unlocked").eq("user_id",t.user.id).eq("feature_key",e).maybeSingle();if(n)throw n;return a?.unlocked??!1}async function o(e,t){void 0===t&&(t={});const{data:{session:r},error:o}=await s.N.auth.getSession();if(o||!r?.user)throw new Error("Not authenticated");if(await n(e))return!0;const{error:i}=await s.N.from("unlocks").insert({user_id:r.user.id,feature_key:e,unlocked:!0,payload:t});if(i)throw i;return await(0,a.R)("unlock",{feature_key:e,payload:t}),!0}},5599:(e,t,r)=>{r.d(t,{A:()=>a});r(6540);var s=r(4848);function a(e){let{self:t=0}=e;return(0,s.jsx)("pre",{className:"bg-[#f4f4f4] border border-gray-200 rounded-lg p-4 text-sm leading-6",children:`self (${t.toFixed(1)})\n\u251c\u2500 mental    [fogged]\n\u2514\u2500 physical  [fogged]`})}},9396:(e,t,r)=>{r.r(t),r.d(t,{default:()=>w});var s=r(6540),a=r(1410),n=r(6289),o=r(4610),i=r(9508),c=r(4448),l=r(5541),d=r(3699),u=r(4848);function f(e){let{initialSelf:t,initialTokens:r,onRefresh:a}=e;const[n,i]=(0,s.useState)(t??0),[f,h]=(0,s.useState)(r??0),[w,m]=(0,s.useState)("");return(0,u.jsxs)("div",{className:"bg-white border rounded-lg p-5 shadow-sm space-y-4",children:[(0,u.jsxs)("div",{className:"text-lg font-semibold",children:["Self: ",(0,u.jsx)("span",{className:"font-bold",children:n.toFixed(1)})]}),(0,u.jsx)("button",{className:"btn btn-primary",onClick:async()=>{if(m(""),f<1)m("\u274c Not enough tokens.");else try{await(0,c.Rf)(1,"token","increase-self");const e=parseFloat((n+1).toFixed(1));i(e),h(f-1),await(0,o.t9)({self:e}),await(0,d.R)("self_upgrade",{delta:1,newSelf:e});!await(0,l.s)("symbol_tree_revealed")&&e>=2&&await(0,l.T)("symbol_tree_revealed",{triggeredBy:"self >= 2.0"}),a&&a()}catch(e){console.error(e),m("\u274c Failed to spend token.")}},children:"Spend 1 Token"}),w&&(0,u.jsx)("div",{className:"text-sm text-blue-600",children:w})]})}var h=r(5599);function w(){const[e,t]=(0,s.useState)(null),[r,c]=(0,s.useState)(!1),[d,w]=(0,s.useState)(!0),m=async()=>{const e=await(0,o.gi)();t(e);const r=await(0,l.s)("symbol_tree_revealed");c(r),w(!1)};return(0,s.useEffect)((()=>{m()}),[]),d||!e?(0,u.jsx)(a.A,{title:"Self Growth",children:(0,u.jsx)("div",{className:"text-center mt-24 text-lg",children:"Loading\u2026"})}):(0,u.jsx)(a.A,{title:"Self Growth",children:(0,u.jsxs)("main",{className:"max-w-3xl mx-auto p-6 space-y-8",children:[(0,u.jsxs)("header",{className:"flex items-center justify-between mb-6",children:[(0,u.jsx)("h1",{className:"text-3xl font-bold",children:"Self Growth"}),(0,u.jsx)(n.A,{className:"btn btn-outline",to:"/profile",children:"\u2190 Back to Profile"})]}),(0,u.jsx)(i.A,{type:"token"}),(0,u.jsx)(f,{initialSelf:e.self,initialTokens:e.tokens_json?.token??0,onRefresh:m}),r&&(0,u.jsxs)("section",{children:[(0,u.jsx)("h2",{className:"text-xl font-semibold mt-8 mb-4",children:"Symbol Tree"}),(0,u.jsx)(h.A,{self:e.self})]})]})})}},9508:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(6540),a=r(4448),n=r(4848);function o(e){let{type:t="token"}=e;const[r,o]=(0,s.useState)(null),[i,c]=(0,s.useState)(!0);return(0,s.useEffect)((()=>{(0,a.r1)(t).then(o).catch((()=>o(null))).finally((()=>c(!1)))}),[t]),i?(0,n.jsx)("p",{children:"Loading tokens..."}):(0,n.jsxs)("div",{style:{fontWeight:"bold",marginBottom:"1rem"},children:["Tokens: ",r??0]})}}}]);