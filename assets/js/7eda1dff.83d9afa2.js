"use strict";(self.webpackChunkbunker=self.webpackChunkbunker||[]).push([[6845],{112:(t,e,a)=>{a.d(e,{N:()=>r});const s="https://woqkezopnodqylfjhagq.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndvcWtlem9wbm9kcXlsZmpoYWdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQyMjE1OTksImV4cCI6MjA1OTc5NzU5OX0.2k_UQ3iL7794EtqMCfA0NGjjdu8yQn4xQPtnoQFK-Pg";const r=(0,a(6017).UU)(s,n)},4610:(t,e,a)=>{a.d(e,{CE:()=>n,gi:()=>r,t9:()=>o});var s=a(112);async function n(){const{data:t,error:e}=await s.N.from("characters").select().maybeSingle();if(e)throw console.error("[character] Fetch error:",e.message),e;if(t)return t;const{data:a,error:n}=await s.N.from("characters").insert({display_name:"New Adventurer",stats:{level:1,health:100,stamina:50,keywords:[]}}).select().single();if(n)throw console.error("[character] Insert error:",n.message),n;return a}async function r(){const{data:t,error:e}=await s.N.from("characters").select().maybeSingle();if(e)throw console.error("[character] Get error:",e.message),e;return t}async function o(t){const{data:e,error:a}=await s.N.from("characters").update(t).select().single();if(a)throw a;return e}},8656:(t,e,a)=>{a.r(e),a.d(e,{default:()=>d});var s=a(6540),n=a(1410),r=a(112),o=a(4610),c=a(4848);function i(){return(0,c.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,c.jsx)("p",{children:"Loading\u2026"})})}var l=a(2925);const u=()=>{const[t,e]=(0,s.useState)(null);(0,s.useEffect)((()=>{const t=new l.A.Tour({defaultStepOptions:{cancelIcon:{enabled:!0},scrollTo:{behavior:"smooth",block:"center"},classes:"shepherd-theme-arrows"},useModalOverlay:!0});t.addStep({id:"display-name",text:"This is your public display name. You can change it here.",attachTo:{element:'[data-tour="display-name"]',on:"bottom"},buttons:[{text:"Next",action:t.next}]}),t.addStep({id:"stats",text:"Here you can monitor your character\u2019s stats.",attachTo:{element:'[data-tour="stats"]',on:"top"},buttons:[{text:"Back",action:t.back},{text:"Next",action:t.next}]}),t.addStep({id:"sign-out",text:"Use this button to sign out.",attachTo:{element:'[data-tour="sign-out"]',on:"bottom"},buttons:[{text:"Back",action:t.back},{text:"Done",action:t.complete}]}),e(t),localStorage.getItem("tour-profile-seen")||(t.start(),localStorage.setItem("tour-profile-seen","true"))}),[]);return(0,c.jsx)("div",{className:"text-right mb-4",children:(0,c.jsx)("button",{onClick:()=>{t&&t.start()},className:"btn btn-outline",children:"\ud83d\udcd8 Show Tour Again"})})};function d(){const[t,e]=(0,s.useState)(null),[a,l]=(0,s.useState)(null),[d,h]=(0,s.useState)(!0),[m,b]=(0,s.useState)(null),[p,x]=(0,s.useState)(!1);(0,s.useEffect)((()=>{(async()=>{const{data:t}=await r.N.auth.getSession();t?.session&&e(t.session)})();const{data:t}=r.N.auth.onAuthStateChange(((t,a)=>{e(a)}));return()=>t.subscription.unsubscribe()}),[]),(0,s.useEffect)((()=>{t&&(async()=>{try{const t=await(0,o.gi)();if(!t)throw new Error("No character found for user");l(t)}catch(t){b(t.message)}finally{h(!1)}})()}),[t]),(0,s.useEffect)((()=>{d||m||!a||setTimeout((()=>x(!0)),800)}),[d,m,a]);return t?d?(0,c.jsx)(n.A,{title:"Profile",children:(0,c.jsx)(i,{})}):m?(0,c.jsx)(n.A,{title:"Profile",children:(0,c.jsxs)("p",{children:["Error: ",m]})}):(0,c.jsxs)(n.A,{title:"Profile",children:[p&&(0,c.jsx)(u,{steps:[{selector:'[data-tour="display-name"]',content:"\ud83e\uddd1 This is your public display name. You can change it here."},{selector:'[data-tour="stats"]',content:"\ud83d\udcca These are your character\u2019s current stats."},{selector:'[data-tour="sign-out"]',content:"\ud83d\udeaa Use this button to sign out when finished."}]}),(0,c.jsxs)("section",{className:"max-w-2xl mx-auto p-4",children:[(0,c.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Account"}),(0,c.jsxs)("div",{className:"border p-4 rounded-lg mb-6",children:[(0,c.jsxs)("p",{children:["Email: ",t.user.email]}),(0,c.jsx)("button",{className:"btn btn-secondary mt-2","data-tour":"sign-out",onClick:()=>r.N.auth.signOut(),children:"Sign Out"})]}),(0,c.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Character"}),(0,c.jsxs)("div",{className:"border p-4 rounded-lg",children:[(0,c.jsx)("label",{className:"block font-semibold mb-1",children:"Display Name"}),(0,c.jsx)("input",{"data-tour":"display-name",className:"input mb-3",value:a.display_name||"",onChange:t=>l({...a,display_name:t.target.value}),onBlur:async()=>{await(0,o.t9)({display_name:a.display_name})}}),(0,c.jsx)("label",{className:"block font-semibold mb-1",children:"Stats"}),(0,c.jsx)("pre",{"data-tour":"stats",className:"bg-gray-900 text-green-300 p-3 rounded",children:JSON.stringify(a.stats,null,2)})]})]})]}):(0,c.jsx)(n.A,{title:"Profile",children:(0,c.jsx)("p",{children:"You need to sign in first."})})}}}]);